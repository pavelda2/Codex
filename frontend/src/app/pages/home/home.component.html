<section class="home-screen" [class.has-query]="state.searchQuery().trim().length > 0">
  <div class="search-layout">
    <div class="search-wrap">
      <label class="search-label" for="recipe-search">Find recipe</label>
      <input
        id="recipe-search"
        type="search"
        placeholder="name, ingredient, step"
        [ngModel]="state.searchQuery()"
        (ngModelChange)="state.searchQuery.set($event)"
      />
    </div>

    @if (state.searchQuery().trim().length > 0) {
      <section class="results" [class.loading]="state.loading()">
        @if (state.loading()) {
          <p>Loading</p>
        } @else if (state.searchResults().length === 0) {
          <p>No recipes</p>
        } @else {
          <ul class="recipe-list">
            @for (result of state.searchResults(); track result.recipe.id) {
              <li>
                <button
                  type="button"
                  class="recipe-item"
                  [class.recipe-item-with-image]="hasThumb(result.recipe)"
                  [class.recipe-item-no-image]="!hasThumb(result.recipe)"
                  (click)="open(result.recipe.id)"
                >
                  @if (firstThumb(result.recipe); as thumb) {
                    <img [src]="thumb" alt="Recipe image" loading="lazy" />
                  }
                  <div class="recipe-meta">
                    <span class="recipe-title-parts" aria-label="Recipe title">
                      @for (part of result.titleParts; track $index) {
                        @if (part.highlighted) {
                          <mark [textContent]="part.text"></mark>
                        } @else {
                          <span [textContent]="part.text"></span>
                        }
                      }
                    </span>

                    @if (result.contentParts.length > 0) {
                      <small class="recipe-snippet" [attr.aria-label]="result.contentLabel || 'Recipe snippet'">
                        @for (part of result.contentParts; track $index) {
                          @if (part.highlighted) {
                            <mark [textContent]="part.text"></mark>
                          } @else {
                            <span [textContent]="part.text"></span>
                          }
                        }
                      </small>
                    }
                  </div>
                </button>
              </li>
            }
          </ul>
        }
      </section>
    }
  </div>
</section>
