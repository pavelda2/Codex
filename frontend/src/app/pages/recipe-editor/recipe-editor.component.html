<section class="editor-screen">
  <svg class="icon-sprite" aria-hidden="true" focusable="false">
    <symbol id="icon-primary" viewBox="0 0 24 24">
      <path d="M12 3l2.65 5.38L20.6 9.25l-4.3 4.2 1.01 5.95L12 16.62l-5.31 2.78 1.01-5.95-4.3-4.2 5.95-.87L12 3z" />
    </symbol>
  </svg>

  <header class="editor-topbar">
    <div class="tabs" role="tablist" aria-label="Editor sections">
      <button
        type="button"
        role="tab"
        class="tab"
        [class.active]="activeTab() === 'content'"
        [attr.aria-selected]="activeTab() === 'content'"
        (click)="setTab('content')"
      >
        Recipe
      </button>
      <button
        type="button"
        role="tab"
        class="tab"
        [class.active]="activeTab() === 'images'"
        [attr.aria-selected]="activeTab() === 'images'"
        (click)="setTab('images')"
      >
        Images ({{ images().length }})
      </button>
    </div>

    <button type="button" class="save" (click)="save()" [disabled]="state.saving() || !api.canWrite()">
      {{ state.saving() ? 'Saving' : 'Save' }}
    </button>
  </header>

  @if (state.error()) {
    <p class="error">{{ state.error() }}</p>
  }

  @if (activeTab() === 'content') {
    <section class="content-tab" role="tabpanel">
      <textarea
        [ngModel]="state.rawText()"
        (ngModelChange)="state.rawText.set($event)"
        rows="15"
        placeholder="Recipe"
        [disabled]="!api.canWrite()"
      ></textarea>

      <div class="preview-card">
        <app-recipe-preview [parsed]="state.parsed()" [showWarnings]="true" />
      </div>
    </section>
  }

  @if (activeTab() === 'images') {
    <section class="images-tab" role="tabpanel">
      <header class="images-header">
        <h3>Recipe images</h3>
        <p>Choose primary image and keep only the photos you need.</p>
      </header>

      <input
        #addImagesInput
        class="visually-hidden"
        type="file"
        accept="image/*"
        multiple
        (change)="addImages($event)"
        [disabled]="!api.canWrite()"
      />

      <button type="button" class="upload" (click)="addImagesInput.click()" [disabled]="!api.canWrite()">
        Add images
      </button>

      @if (images().length === 0) {
        <p class="empty">No images yet. Add your first photo.</p>
      } @else {
        <div class="image-grid">
          @for (image of images(); track image.id) {
            <article class="image-card">
              <div class="image-media">
                <img [src]="image.thumbDataUrl" alt="Recipe thumbnail" />
                <button
                  type="button"
                  class="primary-corner"
                  [class.active]="isPrimaryImage(image.id)"
                  (click)="setPrimaryImage(image.id)"
                  [disabled]="!api.canWrite()"
                  [attr.aria-label]="isPrimaryImage(image.id) ? 'Primary image selected' : 'Set as primary image'"
                  [title]="isPrimaryImage(image.id) ? 'Primary image' : 'Set as primary image'"
                >
                  <svg class="icon" aria-hidden="true"><use href="#icon-primary"></use></svg>
                </button>
              </div>

              <div class="image-actions">
                <input
                  #replaceInput
                  class="visually-hidden"
                  type="file"
                  accept="image/*"
                  (change)="replaceImage(image.id, $event)"
                  [disabled]="!api.canWrite()"
                />
                <button type="button" class="ghost" (click)="replaceInput.click()" [disabled]="!api.canWrite()">
                  Replace
                </button>
                <button type="button" class="danger" (click)="removeImage(image.id)" [disabled]="!api.canWrite()">
                  Remove
                </button>
              </div>
            </article>
          }
        </div>
      }
    </section>
  }
</section>
